{% extends "base.html" %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-5 fw-bold">Employee Management</h1>
        <a href="{{ url_for('employees.add_employee') }}" class="btn btn-success btn-lg rounded-pill px-4">
          <i class="lni lni-plus"></i> Add Employee
        </a>
      </div>

     <!-- Search and Filter -->
     <div class="card shadow-sm mb-4">
       <div class="card-body">
         <form method="GET">
           <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
           <div class="row g-3">
             <div class="col-md-3">
               <input type="text" name="search" class="form-control" placeholder="Search by name, ID..." value="{{ request.args.get('search', '') }}">
             </div>
             <div class="col-md-2">
               <select name="departement" class="form-select">
                 <option value="">All departments</option>
                 {% for dept in departments %}
                 <option value="{{ dept }}" {% if request.args.get('departement') == dept %}selected{% endif %}>{{ dept }}</option>
                 {% endfor %}
               </select>
             </div>
             <div class="col-md-2">
               <select name="status" class="form-select">
                 <option value="">All statuses</option>
                 <option value="active" {% if request.args.get('status') == 'active' %}selected{% endif %}>Active</option>
                 <option value="terminated" {% if request.args.get('status') == 'terminated' %}selected{% endif %}>Terminated</option>
               </select>
             </div>
             <div class="col-md-2">
               <select name="year" class="form-select">
                 <option value="">All years</option>
                 {% for year in years %}
                 <option value="{{ year }}" {% if request.args.get('year') == year|string %}selected{% endif %}>{{ year }}</option>
                 {% endfor %}
               </select>
             </div>
             <div class="col-md-3">
               <button type="submit" class="btn btn-primary w-100">Filter</button>
               <a href="{{ url_for('employees.list_employees') }}" class="btn btn-outline-secondary w-100 mt-1">Clear</a>
             </div>
           </div>
         </form>
       </div>
     </div>
      <!-- Employees Table -->
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Matricule</th>
                  <th>Full Name</th>
                  <th>Age</th>
                  <th>Position</th>
                  <th>Department</th>
                  <th>Salary</th>
                  <th>Indemnite 1</th>
                  <th>Indemnite 2</th>
                  <th>Date Joined</th>
                  <th>Date Left</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if employees %}
                  {% for employee in employees %}
                  <tr class="{% if employee.date_left %}text-muted{% endif %}" style="{% if employee.date_left %}opacity: 0.6;{% endif %}">
                    <td>{{ employee.matricule }}</td>
                    <td>{{ employee.first_name }} {{ employee.last_name }}</td>
                    <td>{{ employee.age or '-' }}</td>
                    <td>{{ employee.position or '-' }}</td>
                    <td>{{ employee.departement or '-' }}</td>
                    <td>{{ '%.2f'|format(employee.salary) if employee.salary else '-' }} €</td>
                    <td>{{ '%.2f'|format(employee.indemnite1) if employee.salary else '-' }} €</td>
                    <td>{{ '%.2f'|format(employee.indemnite2) if employee.salary else '-' }} €</td>
                    <td>{{ '%.2f'|format(employee.salary) if employee.salary else '-' }} €</td>
                    <td>{{ employee.date_joined or '-' }}</td>
                    <td>
                      {% if employee.date_left %}
                        <span class="text-danger">{{ employee.date_left }}</span>
                      {% else %}
                        -
                      {% endif %}
                    </td>
                    <td>
                      {% if employee.date_left %}
                        <span class="badge bg-secondary">Terminated</span>
                      {% else %}
                        <span class="badge bg-success">Active</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        {% if not employee.date_left %}
                          <a href="{{ url_for('employees.edit_employee', matricule=employee.matricule) }}" class="btn btn-outline-primary" title="Edit">
                            <i class="lni lni-pencil"></i>
                          </a>
                          <a href="{{ url_for('employees.terminate_employee', matricule=employee.matricule) }}" class="btn btn-outline-warning" title="Terminate" onclick="return confirm('Are you sure you want to terminate this employee?')">
                            <i class="lni lni-close"></i>
                          </a>
                        {% else %}
                          <button class="btn btn-outline-secondary" disabled title="Cannot edit terminated employee">
                            <i class="lni lni-pencil"></i>
                          </button>
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="10" class="text-center py-5 text-muted">
                      <i class="lni lni-users" style="font-size: 3rem;"></i>
                      <p class="mt-3">No employees found</p>
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}